<%# Если товар все еще существует, обновляем его %>
<% if @cart_item&.persisted? %>
  <%= turbo_stream.replace "cart-item-#{@cart_item.id}" do %>
    <%= render 'cart_items/cart_item', cart_item: @cart_item %>
  <% end %>
<% end %>

<%# Обновляем всю корзину %>
<%= turbo_stream.replace "cart-summary" do %>
  <%= render 'cart_summary' %>
<% end %>

<%# Обновляем бейдж с количеством товаров в заголовке %>
<% word_form = if @total_items % 10 == 1 && @total_items % 100 != 11
                "товар"
              elsif [2, 3, 4].include?(@total_items % 10) && ![12, 13, 14].include?(@total_items % 100)
                "товара"
              else
                "товаров"
              end %>

<%= turbo_stream.replace "cart-items-badge" do %>
  <div class="" id="cart-items-badge">
    <%= @total_items %> <%= word_form %>
  </div>
<% end %>

<%# Если корзина стала пустой, показываем сообщение %>
<% if @cart_items.empty? %>
  <%= turbo_stream.replace "cart-items-container" do %>
    <div class="flex flex-col items-center justify-center py-12 md:py-16">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-base-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
      </svg>
      <h3 class="text-xl font-semibold text-base-content/70 mb-2">Ваша корзина пуста</h3>
      <p class="text-base-content/50 mb-6">Добавьте что-нибудь из нашего меню</p>
      <%= link_to "Перейти в меню", menu_path, class: "btn btn-primary" %>
    </div>
  <% end %>
<% end %>

<%= turbo_stream.replace "cart-count", partial: "shared/cart_badge", locals: { count: @total_items } if @total_items.present? %>
