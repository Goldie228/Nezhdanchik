<% themes = [
  { key: "coffee", label: "Кофе", prefersdark: true, default: true },
  { key: "luxury", label: "Роскошь", prefersdark: true },
  { key: "night", label: "Ночная", prefersdark: true },
  { key: "dim", label: "Тусклая", prefersdark: true },
  { key: "halloween", label: "Хэллоуин", prefersdark: true },
  { key: "business", label: "Бизнес", prefersdark: true }
] %>

<% current_key = cookies[:site_theme].presence %>
<% current_theme = themes.find { |t| t[:key] == current_key } %>
<% current_label = current_theme ? current_theme[:label] : (themes.find { |t| t[:default] }[:label] rescue "Кофе") %>

<div class="dropdown dropdown-end" data-controller="theme">
  <label tabindex="0" class="btn btn-ghost gap-2" data-theme-target="button" aria-haspopup="true" aria-expanded="false">
    <span data-theme-target="label"><%= current_label %></span>
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </label>

  <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52" data-theme-target="list" role="menu" aria-label="Выбор темы">
    <% themes.each do |t| %>
      <li role="none">
        <a href="#"
           role="menuitemradio"
           aria-checked="<%= (t[:key] == current_key).to_s %>"
           class="flex items-center gap-3 px-2 py-1 rounded hover:bg-base-200"
           data-action="click->theme#select"
           data-theme-key="<%= t[:key] %>">

          <span class="w-4 h-4 flex items-center justify-center">
            <svg class="check w-3 h-3 <%= (t[:key] == current_key) ? '' : 'opacity-0' %>" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <path d="M20 6L9 17l-5-5"/>
            </svg>
          </span>

          <span class="flex-1"><%= t[:label] %></span>
        </a>
      </li>
    <% end %>
  </ul>
</div>
